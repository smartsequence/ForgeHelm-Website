---
import Layout from '../../layouts/Layout.astro';
import { CONTACT_EMAIL } from '../../consts';
import { getTranslations, getLocalizedPath } from '../../i18n/utils';
import { defaultLang, type Language, getAllLanguageCodes } from '../../i18n/languages';

// ç”Ÿæˆæ‰€æœ‰èªè¨€ç‰ˆæœ¬çš„éœæ…‹è·¯å¾‘
export async function getStaticPaths() {
	const allLangs = getAllLanguageCodes();
	return allLangs
		.filter((lang) => lang !== defaultLang)
		.map((lang) => ({
			params: { lang },
		}));
}

// å¾ URL åƒæ•¸å–å¾—èªè¨€
const lang = (Astro.params.lang || defaultLang) as Language;
const translations = await getTranslations(lang);

// ç²å– URL åƒæ•¸
const type = Astro.url.searchParams.get('type') || '';
const source = Astro.url.searchParams.get('source') || '';

// ç¿»è­¯å‡½å¼
function t(key: string): string {
	const keys = key.split('.');
	let value: any = translations;
	for (const k of keys) {
		value = value?.[k];
		if (value === undefined) return key;
	}
	return value || key;
}
---

<Layout 
	title={t('pages.contact.title')}
	description={t('pages.contact.description')}
>
	<!-- Hero å€å¡Š -->
	<section class="hero">
		<div class="container">
			<h1>{t('pages.contact.heroTitle')}</h1>
			<p class="hero-subtitle" set:html={t('pages.contact.heroSubtitle').replace(/\n/g, '<br>')}></p>
		</div>
	</section>

	<!-- è¯çµ¡è¡¨å–®èˆ‡è³‡è¨Š -->
	<section class="section contact-main">
		<div class="container">
			<div class="contact-grid">
				<!-- è¯çµ¡è¡¨å–® -->
				<div class="form-section">
					<h2>{t('pages.contact.formTitle')}</h2>
					<p class="form-desc">{t('pages.contact.formDesc')}</p>
					
					<form class="contact-form" action="https://api.web3forms.com/submit" method="POST">
						<input type="hidden" name="access_key" value="YOUR_WEB3FORMS_KEY">
						<input type="hidden" name="from_page" value={type ? `contact-${type}` : 'contact'}>
						<input type="hidden" name="source" value={source}>
						
						<div class="form-group">
							<label for="name">{t('pages.contact.nameLabel')} <span class="required">*</span></label>
							<input 
								type="text" 
								id="name" 
								name="name" 
								required 
								placeholder={lang === 'en' ? 'Enter your name' : 'è«‹è¼¸å…¥æ‚¨çš„å§“å'}
							>
						</div>

						<div class="form-group">
							<label for="email">{t('pages.contact.emailLabel')} <span class="required">*</span></label>
							<input 
								type="email" 
								id="email" 
								name="email" 
								required 
								placeholder="your.email@example.com"
							>
						</div>

						<div class="form-group">
							<label for="company">{t('pages.contact.companyLabel')} <span class="optional">({t('pages.contact.companyOptional')})</span></label>
							<input 
								type="text" 
								id="company" 
								name="company" 
								placeholder={lang === 'en' ? 'Company name (if enterprise inquiry)' : 'å¦‚ç‚ºä¼æ¥­æ´½è©¢ï¼Œè«‹å¡«å¯«å…¬å¸åç¨±'}
							>
						</div>

						<div class="form-group">
							<label for="subject">{t('pages.contact.subjectLabel')} <span class="required">*</span></label>
							<select id="subject" name="subject" required>
								<option value="">{t('pages.contact.subjectPlaceholder')}</option>
								<option value="trial" {type === 'trial' ? 'selected' : ''}>{t('pages.contact.subjectTrial')}</option>
								<option value="enterprise" {type === 'enterprise' ? 'selected' : ''}>{t('pages.contact.subjectEnterprise')}</option>
								<option value="payment">{t('pages.contact.subjectPayment')}</option>
								<option value="support">{t('pages.contact.subjectSupport')}</option>
								<option value="other">{t('pages.contact.subjectOther')}</option>
							</select>
						</div>

						<div class="form-group">
							<label for="message">{t('pages.contact.messageLabel')} <span class="required">*</span></label>
							<textarea 
								id="message" 
								name="message" 
								required 
								rows="6"
								placeholder={t('pages.contact.messagePlaceholder')}
							></textarea>
						</div>

						<button type="submit" class="submit-btn">{t('pages.contact.submitButton')}</button>
						
						<p class="form-note">{lang === 'en' ? '* Required fields' : '* ç‚ºå¿…å¡«æ¬„ä½'}</p>
					</form>
				</div>

				<!-- è¯çµ¡è³‡è¨Š -->
				<div class="info-section">
					<h2>{lang === 'en' ? 'Other Contact Methods' : 'å…¶ä»–è¯çµ¡æ–¹å¼'}</h2>
					
					<div class="contact-method">
						<div class="method-icon">ğŸ“§</div>
						<div class="method-content">
							<h3>{t('pages.contact.emailTitle')}</h3>
							<p><a href={`mailto:${CONTACT_EMAIL}`}>{CONTACT_EMAIL}</a></p>
							<p class="method-note">{t('pages.contact.responseTime')}</p>
						</div>
					</div>

					<div class="contact-method">
						<div class="method-icon">ğŸ’¬</div>
						<div class="method-content">
							<h3>{lang === 'en' ? 'LINE Official Account' : 'LINE å®˜æ–¹å¸³è™Ÿ'}</h3>
							<p>{lang === 'en' ? 'LINE ID: @smartsequence' : 'LINE ID: @smartsequence'} <span class="note-small">({lang === 'en' ? 'Please update actual ID' : 'è«‹æ›´æ–°å¯¦éš› ID'})</span></p>
							<p class="method-note">{lang === 'en' ? 'Real-time consultation: Mon-Fri 10:00-18:00' : 'å³æ™‚è«®è©¢ï¼šé€±ä¸€è‡³é€±äº” 10:00-18:00'}</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- å¿«é€Ÿé€£çµ -->
	<section class="section quick-links">
		<div class="container">
			<h2 class="section-title">{lang === 'en' ? 'Quick Navigation' : 'å¸¸è¦‹éœ€æ±‚å¿«é€Ÿå°èˆª'}</h2>
			
			<div class="links-grid">
				<a href={getLocalizedPath('/pricing', lang)} class="link-card">
					<div class="link-icon">ğŸ’°</div>
					<h3>{lang === 'en' ? 'View Pricing Plans' : 'æŸ¥çœ‹å®šåƒ¹æ–¹æ¡ˆ'}</h3>
					<p>{lang === 'en' ? 'Learn about fees and plan details' : 'ç­è§£è²»ç”¨èˆ‡æ–¹æ¡ˆå…§å®¹'}</p>
				</a>

				<a href={getLocalizedPath('/get-started?source=contact-demo', lang)} class="link-card">
					<div class="link-icon">ğŸ“‹</div>
					<h3>{lang === 'en' ? 'Preview Sample Report' : 'é è¦½ç¯„ä¾‹å ±å‘Š'}</h3>
					<p>{lang === 'en' ? 'See actual report quality' : 'çœ‹å¯¦éš›å ±å‘Šå“è³ª'}</p>
				</a>

				<a href={getLocalizedPath('/pricing#faq', lang)} class="link-card">
					<div class="link-icon">â“</div>
					<h3>{lang === 'en' ? 'FAQ' : 'å¸¸è¦‹å•é¡Œ FAQ'}</h3>
					<p>{lang === 'en' ? 'Invoice, payment, data security' : 'ç™¼ç¥¨ã€ä»˜æ¬¾ã€è³‡æ–™å®‰å…¨'}</p>
				</a>

				<a href={getLocalizedPath('/get-started?source=contact-trial', lang)} class="link-card">
					<div class="link-icon">ğŸš€</div>
					<h3>{lang === 'en' ? 'Get Started Now' : 'ç«‹å³é–‹å§‹ä½¿ç”¨'}</h3>
					<p>{lang === 'en' ? 'Free trial ForgeHelm' : 'å…è²»è©¦ç”¨ ForgeHelm'}</p>
				</a>
			</div>
		</div>
	</section>
</Layout>

<style>
	/* è¤‡è£½ contact.astro çš„æ¨£å¼ */
	.hero {
		background: var(--bg-main);
		color: var(--text-primary);
		padding: 0.25rem 0 3rem;
		text-align: center;
		border-bottom: 1px solid var(--border-light);
	}

	.hero h1 {
		font-size: 2.5rem;
		margin-bottom: 1rem;
	}

	.hero-subtitle {
		font-size: 1.125rem;
		opacity: 0.95;
		line-height: 1.75;
	}

	.contact-grid {
		display: grid;
		grid-template-columns: minmax(520px, 1.6fr) minmax(320px, 1fr);
		gap: 2.5rem;
		align-items: start;
	}

	.form-section h2 {
		font-size: 1.75rem;
		margin-bottom: 0.5rem;
		color: var(--text-primary);
	}

	.form-desc {
		color: var(--text-secondary);
		margin-bottom: 2rem;
	}

	.contact-form {
		background: var(--bg-card);
		padding: 2.5rem;
		border-radius: 1rem;
		border: 1px solid var(--border-color);
		box-shadow: var(--shadow-sm);
	}

	.form-group {
		margin-bottom: 1.5rem;
	}

	.form-group label {
		display: block;
		margin-bottom: 0.5rem;
		font-weight: 600;
		color: var(--text-primary);
	}

	.required {
		color: var(--cta-danger);
	}

	.optional {
		font-weight: 400;
		color: var(--text-secondary);
		font-size: 0.875rem;
	}

	.form-group input,
	.form-group select,
	.form-group textarea {
		width: 100%;
		padding: 0.75rem;
		background: var(--bg-section);
		border: 1px solid var(--border-color);
		border-radius: 0.5rem;
		font-family: inherit;
		font-size: 1rem;
		transition: border-color 0.2s ease;
		color: var(--text-primary);
	}

	.form-group input:focus,
	.form-group select:focus,
	.form-group textarea:focus {
		outline: none;
		border-color: var(--cta-primary);
	}

	.form-group textarea {
		resize: vertical;
		min-height: 150px;
	}

	.submit-btn {
		width: 100%;
		padding: 0.875rem;
		background: var(--cta-primary);
		color: white;
		border: none;
		border-radius: 0.5rem;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
		transition: all 0.2s ease;
	}

	.submit-btn:hover {
		transform: translateY(-2px);
		background: var(--cta-hover);
		box-shadow: var(--shadow-md);
	}

	.form-note {
		margin-top: 1rem;
		font-size: 0.875rem;
		color: var(--text-secondary);
		text-align: center;
	}

	.info-section h2 {
		font-size: 1.75rem;
		margin-bottom: 2rem;
		color: var(--text-primary);
	}

	.contact-method {
		background: var(--bg-card);
		padding: 1.5rem;
		border-radius: 1rem;
		border: 1px solid var(--border-color);
		margin-bottom: 1.5rem;
		display: flex;
		gap: 1rem;
	}

	.method-icon {
		font-size: 2rem;
		flex-shrink: 0;
	}

	.method-content h3 {
		font-size: 1.125rem;
		margin-bottom: 0.5rem;
		color: var(--text-primary);
	}

	.method-content p {
		color: var(--text-secondary);
		margin-bottom: 0.25rem;
	}

	.method-content a {
		color: var(--cta-primary);
		text-decoration: none;
	}

	.method-content a:hover {
		text-decoration: underline;
	}

	.method-note {
		font-size: 0.875rem;
		color: var(--text-secondary);
		margin-top: 0.5rem;
	}

	.note-small {
		font-size: 0.75rem;
		color: var(--text-secondary);
	}

	.quick-links {
		background: var(--bg-section);
	}

	.section-title {
		text-align: center;
		font-size: 2.25rem;
		margin-bottom: 3rem;
		color: var(--text-primary);
	}

	.links-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
		gap: 1.5rem;
	}

	.link-card {
		background: var(--bg-card);
		padding: 2rem;
		border-radius: 1rem;
		border: 1px solid var(--border-color);
		text-decoration: none;
		transition: all 0.2s ease;
		display: block;
		text-align: center;
	}

	.link-card:hover {
		border-color: var(--cta-primary);
		transform: translateY(-2px);
		box-shadow: var(--shadow-md);
	}

	.link-icon {
		font-size: 2.5rem;
		margin-bottom: 1rem;
	}

	.link-card h3 {
		font-size: 1.125rem;
		margin-bottom: 0.5rem;
		color: var(--text-primary);
	}

	.link-card p {
		color: var(--text-secondary);
		margin: 0;
	}

	.section {
		padding: 5rem 0;
	}

	@media (max-width: 968px) {
		.contact-grid {
			grid-template-columns: 1fr;
			gap: 3rem;
		}
	}

	@media (max-width: 768px) {
		.hero h1 {
			font-size: 2rem;
		}

		.section {
			padding: 3rem 0;
		}

		.section-title {
			font-size: 1.75rem;
		}

		.contact-form {
			padding: 1.5rem;
		}

		.links-grid {
			grid-template-columns: 1fr;
		}
	}
</style>
